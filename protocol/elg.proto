syntax = "proto3";

/*
 * Messages exchanged between client and server are comprised of the following
 * sequence of protocol buffer messages.
 *
 * +------------------------------+-----------------------+------------------------------+
 * | RqHeader/RsHeader (10 bytes) | CryptoInfo (18 bytes) | Rq/Rs body (variable length) |
 * +------------------------------+-----------------------+------------------------------+
 *
 * The Rq/Rs body is encrypted after serialization and decrypted before
 * deserialization. The *Header and CryptoInfo fields are not encrypted. 
*/

// Fixed length message.
message RqHeader {
    fixed32 partner_id  = 1;

    // Number of bytes in serialized message, excluding this header.
    fixed32 remaining_length = 2;

    // Length of encoded body portion, exclusive of any padding needed for
    // encryption.
    fixed32 body_length = 3;
}

// Fixed length message.
message RsHeader {
    // Number of bytes in serialized message, excluding this header.
    fixed32 remaining_length=1;

    // Length of encoded body portion, exclusive of any padding needed for
    // encryption.
    fixed32 body_length = 3;
}

// Fixed length message.
message CryptoInfo {
    bytes iv=1; // Always 16 bytes in length
}

// Message body definitions.
//

// Variable length message.
message Rq {
    uint32 sw_version = 3;
    int64 client_mac = 4;
    Aps aps = 5;
    LteCells lte_cells = 6;
    uint32 checksum = 7;
}

message Aps {
    enum ApBand {
        UNKNOWN = 0;
        BAND_2_4 = 1;
        BAND_5 = 2;
    }

    repeated int64 mac = 1;
    repeated sint32 rssi = 2;
    repeated ApBand band = 3;
    repeated bool connected = 4;
}

message LteCells {
    repeated uint32 age = 1;
    repeated uint32 eucid = 2;
    repeated uint32 mcc = 3;
    repeated uint32 mnc = 4;
    repeated sint32 rssi = 5;
}
